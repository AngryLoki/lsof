head	1.11;
access;
symbols;
locks; strict;
comment	@ * @;


1.11
date	2005.11.01.20.24.51;	author abe;	state Exp;
branches;
next	1.10;

1.10
date	2005.08.08.19.48.33;	author abe;	state Exp;
branches;
next	1.9;

1.9
date	2004.03.10.23.50.16;	author abe;	state Exp;
branches;
next	1.8;

1.8
date	2003.10.13.13.31.01;	author abe;	state Exp;
branches;
next	1.7;

1.7
date	2003.10.07.17.32.16;	author abe;	state Exp;
branches;
next	1.6;

1.6
date	2002.10.08.20.16.56;	author abe;	state Exp;
branches;
next	1.5;

1.5
date	2002.04.19.12.08.49;	author abe;	state Exp;
branches;
next	1.4;

1.4
date	2001.02.13.13.50.58;	author abe;	state Exp;
branches;
next	1.3;

1.3
date	2000.12.05.23.47.41;	author abe;	state Exp;
branches;
next	1.2;

1.2
date	2000.11.30.18.45.30;	author abe;	state Exp;
branches;
next	1.1;

1.1
date	2000.11.27.18.24.54;	author abe;	state Exp;
branches;
next	;


desc
@Original distribution from Allan Nathanson <ajn@@apple.com>
@


1.11
log
@Revision 4.77
Update indetification comment.
@
text
@/*
 * dlsof.h - Darwin header file for /dev/kmem-based lsof
 */


/*
 * Copyright 1994 Purdue Research Foundation, West Lafayette, Indiana
 * 47907.  All rights reserved.
 *
 * Written by Victor A. Abell
 *
 * This software is not subject to any license of the American Telephone
 * and Telegraph Company or the Regents of the University of California.
 *
 * Permission is granted to anyone to use this software for any purpose on
 * any computer system, and to alter it and redistribute it freely, subject
 * to the following restrictions:
 *
 * 1. Neither the authors nor Purdue University are responsible for any
 *    consequences of the use of this software.
 *
 * 2. The origin of this software must not be misrepresented, either by
 *    explicit claim or by omission.  Credit to the authors and Purdue
 *    University must appear in documentation and sources.
 *
 * 3. Altered versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 4. This notice may not be removed or altered.
 */


/*
 * $Id: dlsof.h,v 1.10 2005/08/08 19:48:33 abe Exp abe $
 */


#if	!defined(DARWIN_LSOF_H)
#define	DARWIN_LSOF_H	1

#include <stdlib.h>
#include <dirent.h>
#include <nlist.h>
#include <setjmp.h>
#include <string.h>
#include <unistd.h>
#include <sys/conf.h>
#include <sys/filedesc.h>
#include <sys/ucred.h>

#if	DARWINV<800
#include <sys/mount.h>
#define	m_stat	mnt_stat
#else	/* DARWINV>=800 */
#include <sys/mount_internal.h>
#define	m_stat	mnt_vfsstat
#endif	/* DARWINV>=800 */

#if	DARWINV<800
#include <sys/uio.h>
#include <sys/vnode.h>
#else	/* DARWINV>=800 */
#include <sys/vnode.h>
#define	_SYS_SYSTM_H_
struct nameidata { int dummy; };	/* to satisfy function  prototypes */
#include <sys/vnode_internal.h>
#endif	/* DARWINV>=800 */

#include <rpc/types.h>
#define	KERNEL_PRIVATE
#include <sys/socketvar.h>
#undef	KERNEL_PRIVATE
#include <sys/protosw.h>
#include <sys/socket.h>
#include <sys/un.h>
#include <sys/unpcb.h>

# if	defined(AF_NDRV)
#include <net/if_var.h>
#define	KERNEL
#include <sys/kern_event.h>
#undef	KERNEL
#include <net/ndrv.h>
#  if	DARWINV>=530
#define	KERNEL        1
#include <net/ndrv_var.h>
#undef  KERNEL
#  endif	/* DARWINV>=530 */
# endif	/* defined(AF_NDRV) */

# if	defined(AF_SYSTEM)
#include <sys/queue.h>
#define	KERNEL
#include <sys/kern_event.h>
#undef	KERNEL
# endif	/* defined(AF_SYSTEM) */

#include <netinet/in.h>
#include <netinet/in_systm.h>
#include <netinet/ip.h>
#include <net/route.h>
#include <netinet6/ipsec.h>
#include <netinet/in_pcb.h>
#include <netinet/ip_var.h>
#include <netinet/tcp.h>
#include <netinet/tcpip.h>
#include <netinet/tcp_fsm.h>
#include <netinet/tcp_timer.h>
#include <netinet/tcp_var.h>
#include <arpa/inet.h>
#include <net/raw_cb.h>
#include <sys/domain.h>
#define	pmap	RPC_pmap
#include <rpc/rpc.h>
#include <rpc/pmap_prot.h>
#undef	pmap

#include <sys/quota.h>
#include <sys/event.h>

# if	DARWINV<800
#include <paths.h>
#undef	MAXNAMLEN
#include <ufs/ufs/quota.h>
#include <paths.h>
#include <ufs/ufs/quota.h>
#include <ufs/ufs/inode.h>
#include <nfs/rpcv2.h>
#include <nfs/nfs.h>
#include <nfs/nfsproto.h>
#include <nfs/nfsnode.h>

#  if	DARWINV<600
#include <hfs/hfs.h>
#undef	offsetof
# else	/* DARWINV>=600 */
#define	KERNEL
#include <hfs/hfs_cnode.h>
#undef	KERNEL
#  endif        /* DARWINV<600 */
# endif	/* DARWINV<800 */

# if	DARWINV<800
#define	time	t1		/* hack to make dn_times() happy */
#include <miscfs/devfs/devfsdefs.h>
#undef	time
# endif	/* DARWINV<800 */

# if	DARWINV<800
#define	KERNEL
#include <miscfs/fdesc/fdesc.h>
#undef	KERNEL
# endif	/* DARWINV<800 */

# if	DARWINV<800
#include <sys/proc.h>
# else	/* DARWINV>=800 */
#define	PROC_DEF_ENABLED
#define	sleep	kernel_sleep
#include <sys/proc_internal.h>
#undef	sleep
# endif	/* DARWINV<800 */

#include <kvm.h>
#undef	TRUE
#undef	FALSE

# if	DARWINV<800
#include <sys/sysctl.h>
# else	/* DARWINV>=800 */
#include "/usr/include/sys/sysctl.h"
# endif	/* DARWINV<800 */

# if	DARWINV<800
#define	KERNEL
#include <sys/fcntl.h>
#include <sys/file.h>
#undef	KERNEL
# else	/* DARWINV>=800 */
#include <sys/fcntl.h>
#include <sys/file_internal.h>
# endif	/* DARWINV<800 */

# if	defined(HASKQUEUE)
#include <sys/eventvar.h>
# endif	/* defined(HASKQUEUE) */

# if	defined(DTYPE_PSXSEM)
#define	HASPSXSEM				/* has the POSIX semaphore file
						 * type */
# endif	/* defined(DTYPE_PSXSEM) */

# if	defined(DTYPE_PSXSHM)
#define	HASPSXSHM				/* has the POSIX shared memory
						 * file type */
# endif	/* defined(DTYPE_PSXSHM) */

struct vop_advlock_args { int dummy; };	/* to satisfy lf_advlock() prototype */
#include <sys/lockf.h>
#include <sys/lock.h>

/*
 * Compensate for removal of MAP_ENTRY_IS_A_MAP from <vm/vm_map.h>,
 *  This work-around was supplied by John Polstra <jdp@@polstra.com>.
 */

# if	defined(MAP_ENTRY_IS_SUB_MAP) && !defined(MAP_ENTRY_IS_A_MAP)
#define	MAP_ENTRY_IS_A_MAP	0
# endif	/* defined(MAP_ENTRY_IS_SUB_MAP) && !defined(MAP_ENTRY_IS_A_MAP) */

#undef	B_NEEDCOMMIT
#include <sys/buf.h>
#include <sys/signal.h>
#define	user_sigaltstack	sigaltstack
#include <sys/user.h>

#define	COMP_P		const void
#define	DEVINCR		1024	/* device table malloc() increment */
#define	DIRTYPE		dirent	/* directory entry type */

typedef	u_long		KA_T;

#define	KMEM		"/dev/kmem"
#define	LOGINML		MAXLOGNAME
#define	MALLOC_P	void
#define	FREE_P		MALLOC_P
#define	MALLOC_S	size_t

#define	N_UNIX	"/mach_kernel"

#define	QSORT_P		void
#define	READLEN_T	int
#define	STRNCPY_L	size_t
#define	SWAP		"/dev/drum"

# if	DARWINV>=800
#define	SZOFFTYPE	unsigned long long
					/* size and offset internal storage
					 * type */
#define	SZOFFPSPEC	"ll"		/* SZOFFTYPE printf specification
					 * modifier */
# endif	/* DARWINV>=800 */


/*
 * Global storage definitions (including their structure definitions)
 */

struct file * Cfp;

extern int Kd;				/* KMEM descriptor */
extern KA_T Kpa;

struct l_vfs {
	KA_T addr;			/* kernel address */
	fsid_t	fsid;			/* file system ID */

# if	defined(MOUNT_NONE)
	short type;			/* type of file system */
# else	/* !defined(MOUNT_NONE) */
	char *typnm;			/* file system type name */
# endif	/* defined(MOUNT_NONE) */

	char *dir;			/* mounted directory */
	char *fsname;			/* file system name */
	struct l_vfs *next;		/* forward link */
};
extern struct l_vfs *Lvfs;

struct mounts {
        char *dir;              	/* directory (mounted on) */
	char *fsname;           	/* file system
					 * (symbolic links unresolved) */
	char *fsnmres;           	/* file system
					 * (symbolic links resolved) */
        dev_t dev;              	/* directory st_dev */
	dev_t rdev;			/* directory st_rdev */
	INODETYPE inode;		/* directory st_ino */
	mode_t mode;			/* directory st_mode */
	mode_t fs_mode;			/* file system st_mode */
        struct mounts *next;    	/* forward link */
};

#define	X_NCACHE	"ncache"
#define	X_NCSIZE	"ncsize"
#define	NL_NAME		n_name

struct sfile {
	char *aname;			/* argument file name */
	char *name;			/* file name (after readlink()) */
	char *devnm;			/* device name (optional) */
	dev_t dev;			/* device */
	dev_t rdev;			/* raw device */
	u_short mode;			/* S_IFMT mode bits from stat() */
	int type;			/* file type: 0 = file system
				 	 *	      1 = regular file */
	INODETYPE i;			/* inode number */
	int f;				/* file found flag */
	struct sfile *next;		/* forward link */

};

#define	XDR_VOID	(const xdrproc_t)xdr_void 
#define	XDR_PMAPLIST	(const xdrproc_t)xdr_pmaplist


/*
 * Definitions for rnmh.c
 */

# if     defined(HASNCACHE)
#include <sys/uio.h>
#include <sys/namei.h>

#  if	!defined(offsetof)
#define	offsetof(type, member)	((size_t)(&((type *)0)->member))
#  endif	/* !defined(offsetof) */

#define	NCACHE		namecache	/* kernel's structure name */

#define	NCACHE_NM	nc_name		/* name in NCACHE */

#  if	DARWINV<700
#define	NCACHE_NMLEN	nc_nlen		/* name length in NCACHE */
#  endif	/* DARWINV<700 */

#define	NCACHE_NXT	nc_hash.le_next	/* link in NCACHE */
#define	NCACHE_NODEADDR	nc_vp		/* node address in NCACHE */
#define	NCACHE_PARADDR	nc_dvp		/* parent node address in NCACHE */

#  if	defined(HASNCVPID)
#define	NCACHE_NODEID	nc_vpid		/* node ID in NCACHE */
#define	NCACHE_PARID	nc_dvpid	/* parent node ID in NCACHE */
#  endif	/* defined(HASNCVPID) */
# endif  /* defined(HASNCACHE) */

#endif	/* DARWIN_LSOF_H */
@


1.10
log
@Revision 4.76
@
text
@d2 1
a2 1
 * dlsof.h - Darwin header file for lsof
d34 1
a34 1
 * $Id: dlsof.h,v 1.9 2004/03/10 23:50:16 abe Exp abe $
@


1.9
log
@Revision 4.71
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.8 2003/10/13 13:31:01 abe Exp abe $
a44 1
#include <signal.h>
d46 1
d50 2
a51 2
#define m_stat	mnt_stat
#define	KERNEL
d53 16
a68 1
#undef	KERNEL
d70 3
a74 1
#include <sys/socketvar.h>
d102 1
d110 1
a110 2
#include <sys/uio.h>
#include <sys/vnode.h>
d118 4
d123 1
d125 2
d133 1
a133 1
# if	DARWINV<600
d140 2
a141 1
# endif        /* DARWINV<600 */
d143 1
d147 1
d149 1
d153 3
a155 1
#define __APPLE_API_PRIVATE	/* DEBUG */
d157 7
a163 1
#undef __APPLE_API_PRIVATE	/* DEBUG */
d168 1
d170 3
d174 1
a174 1
#define	_KERNEL
a177 1
#undef	_KERNEL
d179 4
d198 1
a198 2
struct vop_advlock_args { int dummy; };	/* to pacify lf_advlock() prototype */
#define __APPLE_API_PRIVATE	/* DEBUG */
a199 2
#undef __APPLE_API_PRIVATE	/* DEBUG */

d208 1
a208 1
#define MAP_ENTRY_IS_A_MAP	0
d213 2
d218 1
a218 1
#define DEVINCR		1024	/* device table malloc() increment */
d225 3
a227 3
#define MALLOC_P	void
#define FREE_P		MALLOC_P
#define MALLOC_S	size_t
d229 1
a229 1
#define N_UNIX	"/mach_kernel"
d231 1
a231 1
#define QSORT_P		void
d233 2
a234 2
#define STRNCPY_L	size_t
#define SWAP		"/dev/drum"
d236 7
d244 1
d278 1
a278 1
	ino_t inode;			/* directory st_ino */
d297 1
a297 1
	ino_t i;			/* inode number */
d303 2
d306 1
@


1.8
log
@Revision 4.69
Darwin 7.0 port
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.7 2003/10/07 17:32:16 abe Exp abe $
d125 1
d127 1
a133 14
/* kinfo_proc.kp_proc */
#define	P_COMM		kp_proc.p_comm
#define	P_PID		kp_proc.p_pid
#define	P_STAT		kp_proc.p_stat
#define	P_VMSPACE	kp_proc.p_vmspace

/* kinfo_proc.kp_eproc */
#define	P_ADDR		kp_eproc.e_paddr
#define	P_PGID		kp_eproc.e_pgid
#define	P_PPID		kp_eproc.e_ppid

/* kinfo_proc.kp_eproc->e_paddr */
#define	P_FD		p_fd

d141 14
d156 1
d158 1
d201 1
a201 3
extern kvm_t *Kd;

# if	defined(P_ADDR)
a202 1
# endif	/* defined(P_ADDR) */
a237 4
extern int Np;				/* number of kernel processes */

extern struct kinfo_proc *P;		/* local process table copy */

@


1.7
log
@Revision 4.69
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.6 2002/10/08 20:16:56 abe Exp abe $
a117 2
#include <sys/namei.h>

d178 1
d265 4
d272 2
d275 2
@


1.6
log
@Revision 4.65
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.5 2002/04/19 12:08:49 abe Exp abe $
d274 1
d277 1
@


1.5
log
@Revision 4.63
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.4 2001/02/13 13:50:58 abe Exp abe $
d60 2
a61 1
#ifdef	AF_NDRV
d63 3
d67 8
a74 2
#endif
#ifdef	AF_SYSTEM
d79 2
a80 1
#endif
d109 1
d112 5
d165 1
a165 1
#if	defined(MAP_ENTRY_IS_SUB_MAP) && !defined(MAP_ENTRY_IS_A_MAP)
d167 1
a167 1
#endif	/* defined(MAP_ENTRY_IS_SUB_MAP) && !defined(MAP_ENTRY_IS_A_MAP) */
@


1.4
log
@Revision 4.55
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.3 2000/12/05 23:47:41 abe Exp abe $
a48 1
#include <sys/mbuf.h>
@


1.3
log
@Revision 4.53
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.2 2000/11/30 18:45:30 abe Exp abe $
d126 1
a126 1
#define	P_PGRP		kp_eproc.e_pgid
@


1.2
log
@Revision 4.53
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.1 2000/11/27 18:24:54 abe Exp abe $
d103 2
a104 1
#define time t1		/* hack, hack, hack */
d108 3
@


1.1
log
@Initial revision
@
text
@d34 1
a34 1
 * $Id: dlsof.h,v 1.1 2000/10/25 21:53:08 ajn Exp $
d155 1
a165 6
# if	defined(N_UNIXV)
#define	N_UNIX_TMP(x)	#x
#define	N_UNIX_STR(x)	N_UNIX_TMP(x)
#define	N_UNIX		N_UNIX_STR(N_UNIXV)
# endif	/* defined(N_UNIXV) */

d227 1
a235 8


/*
 * Definitions for rdev.c
 */

#define	DIRTYPE	dirent
#define HASDNAMLEN	1	/* struct DIRTYPE has d_namlen element */
@
