head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2005.08.08.19.48.33;	author abe;	state Exp;
branches;
next	1.3;

1.3
date	2003.10.14.13.56.37;	author abe;	state Exp;
branches;
next	1.2;

1.2
date	2003.10.13.13.31.01;	author abe;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.08.23.18.07;	author abe;	state Exp;
branches;
next	;


desc
@Ask for the path to the Darwin XNU kernel headers.
@


1.4
log
@Revision 4.76
@
text
@#!/bin/sh
#
# get-hdr-loc.sh -- get Darwin XNU kernel header file location
#
# Interactively requests the specification of the path to the host's Darwin
# XNU kernel header files.  Checks that path and returns it to the caller.
#
# Usage: file1 file2 ... fileN
#
# Where: file1	first header file needed
#	 file2	second header file needed
#	 ...
#	 fileN	last header file needed
#
# Exit:
#
#	Exit code: 0 if path found; path returned on STDOUT
#
#		   1 if path not found: error message returned
#					on STDOUT
#
#set -x	# for DEBUGging

# Check argument count.  There must be at least one argument.

if test $# -lt 1	# {
then
  echo "insufficient arguments: $#"
  exit 1
fi	# }
lst=$*

# Request the path to the Darwin XNU kernel header files.

trap 'stty echo; echo interrupted; exit 1' 1 2 3 15
FOREVER=1
while test $FOREVER -ge 1	# {
do
  if test $FOREVER -eq 1	# {
  then
    echo "---------------------------------------------------------------" 1>&2
    echo "" 1>&2
    echo "Lsof cannot find some Darwin XNU kernel header files it needs." 1>&2
    echo "They should have already been downloaded from:" 1>&2
    echo "" 1>&2
    echo "    http://www.opensource.apple.com/darwinsource/index.html" 1>&2
    echo "" 1>&2
    echo "and then installed.  (See 00FAQ for download and installation" 1>&2
    echo "instructions.)" 1>&2
    echo "" 1>&2
    echo "Please specify the path to the place where they were installed." 1>&2
    echo "" 1>&2
    echo "---------------------------------------------------------------" 1>&2
  fi	# }

  END=0
  while test $END = 0	# {
  do
    echo "" 1>&2
    echo -n "What is the path? " 1>&2
    read HP EXCESS
    HP=`echo echo $HP | /bin/csh -fs`
    if test $? -eq 0	# {
    then
      if test "X$HP" = "X"	# {
      then
        echo "" 1>&2
        echo "+================================+" 1>&2
        echo "| Please enter a non-empty path. |" 1>&2
        echo "+================================+" 1>&2
        echo "" 1>&2
      else
        END=1
      fi	# }
    else
      echo "" 1>&2
      echo "+============================+" 1>&2
      echo "| Please enter a legal path. |" 1>&2
      echo "+============================+" 1>&2
      echo "" 1>&2
    fi	# }
  done	# }
  
  # See if the header files are available in the specified path.

  MH=""
  for i in $lst	# {
  do
    if test ! -f ${HP}/bsd/$i -a ! -f ${HP}/osfmk/$i    # {
    then
      if test "X$MH" = "X"	# {
      then
        MH=$i
      else
        MH="$MH $i"
      fi	# }
    fi	# }
  done	# }
  if test "X$MH" = "X"	# {
  then

    # All header files are available, so return the path and exit cleanly.

    echo $HP
    exit 0
  else
    echo "" 1>&2
    echo "ERROR: not all header files are in:" 1>&2
    echo "" 1>&2
    echo "       ${HP}" 1>&2
    echo "" 1>&2
    echo " These are missing:" 1>&2
    echo "" 1>&2
    echo "     $MH" 1>&2
    FOREVER=2
  fi	# }
done	# }
echo "unknown error"
exit 1
@


1.3
log
@Revision 4.69
Darwin 7 changes.
@
text
@d8 1
a8 1
# Usage: dir file1 file2 ... fileN
d10 1
a10 2
# Where: dir	system directory where needed header files might be
#	 file1	first header file needed
d24 1
a24 1
# Check argument count.  There must be at least two arguments.
d26 1
a26 1
if test $# -lt 2	# {
a30 2
dir=$1
shift
d41 1
a41 1
    echo "-------------------------------------------------------------" 1>&2
d43 2
a44 2
    echo "Lsof makes use of Darwin XNU kernel header files.  They must" 1>&2
    echo "have already been downloaded from:" 1>&2
d48 2
a49 1
    echo "(See 00FAQ for download instructions.)" 1>&2
d51 1
a51 2
    echo "Now you must specify the path to the place to which they were" 1>&2
    echo "downloaded." 1>&2
d53 1
a53 1
    echo "-------------------------------------------------------------" 1>&2
a82 8

  # Add a trailing "/bsd", as required.

  echo $HP | grep "/bsd$" > /dev/null
  if test $? -ne 0	# {
  then
    HP="${HP}/bsd"
  fi	# }
d89 1
a89 1
    if test ! -f ${dir}/$i -a ! -f ${HP}/$i	# {
d110 1
a110 2
    echo "           $dir" 1>&2
    echo "       and ${HP}" 1>&2
@


1.2
log
@Revision 4.69
Darwin 7.0 port
@
text
@d8 1
a8 1
# Usage: file1 file2 ... fileN
d10 2
a11 1
# Where: file1	first header file needed
d25 1
a25 1
# Check argument count.  There must be at least one argument.
d27 1
a27 1
if test $# -lt 1	# {
d32 3
d65 2
a66 1
    if test "X$HP" = "X"	# {
d68 11
d80 3
a82 3
      echo "+================================+" 1>&2
      echo "| Please enter a non-empty path. |" 1>&2
      echo "+================================+" 1>&2
a83 2
    else
      END=1
a86 4
  # Do tilde expansion.

  HP=`echo echo $HP | /bin/csh -fs`

d98 1
a98 1
  for i in $*	# {
d100 1
a100 1
    if test ! -r ${HP}/$i	# {
d121 2
a122 1
    echo "     ${HP}" 1>&2
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
# get-hdr-loc.sh -- get XNU kernel header file location
d5 2
a6 3
# Interactively requests the specification of the path to the host's
# XNU kernel header files.  Checks that path and returns it to the
# caller.
d32 1
a32 1
# Request the path to the XNU kernel header files.
d42 2
a43 2
    echo "Lsof makes use of XNU kernel header files.  They must have" 1>&2
    echo "already been downloaded from:" 1>&2
d45 1
a45 1
    echo "http://www.opensource.apple.com/darwinsource/index.html" 1>&2
d47 2
d73 12
@
