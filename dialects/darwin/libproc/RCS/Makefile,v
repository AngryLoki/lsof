head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2018.02.14.14.27.57;	author abe;	state Exp;
branches;
next	1.7;

1.7
date	2009.03.25.19.21.37;	author abe;	state Exp;
branches;
next	1.6;

1.6
date	2008.10.21.16.15.16;	author abe;	state Exp;
branches;
next	1.5;

1.5
date	2008.04.15.13.28.56;	author abe;	state Exp;
branches;
next	1.4;

1.4
date	2006.03.27.23.23.13;	author abe;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.01.20.18.44;	author abe;	state Exp;
branches;
next	1.2;

1.2
date	2005.11.01.19.45.15;	author abe;	state Exp;
branches;
next	1.1;

1.1
date	2005.11.01.19.41.02;	author abe;	state Exp;
branches;
next	;


desc
@As received from Allan Nathanson, Apple Computer, Inc.
@


1.8
log
@Revision 4.90
@
text
@
# Darwin libproc-based lsof Makefile
#
# $Id: Makefile,v 1.7 2009/03/25 19:21:37 abe Exp abe $

PROG=	lsof

BIN=	${DSTROOT}/usr/sbin

DOC=	${DSTROOT}/usr/share/man/man8

DS=	/usr/bin/dsymutil

I=/usr/include
S=/usr/include/sys
L=/usr/include/local
P=

CDEF=	${RC_CFLAGS}
CDEFS=	${CDEF} ${CFGF}
INCL=	${DINC}
override CFLAGS= ${CDEFS} ${INCL} ${DEBUG}

GRP=    wheel

HDR=    lsof.h lsof_fields.h dlsof.h machine.h proto.h dproto.h

SRC=    ddev.c dfile.c dmnt.c dproc.c dsock.c dstore.c \
	arg.c main.c misc.c node.c print.c proc.c store.c usage.c util.c

OBJ=	ddev.o dfile.o dmnt.o dproc.o dsock.o dstore.o \
	arg.o main.o misc.o node.o print.o proc.o store.o usage.o util.o

MAN=	lsof.8

OTHER=	

SHELL=	/bin/sh

SOURCE=	Makefile ${OTHER} ${MAN} ${HDR} ${SRC}

all: ${PROG}

${PROG}: ${LIB} ${P} ${OBJ}
	${CC} -o $@@ ${CFLAGS} ${OBJ} ${CFGL}

clean: FRC
	rm -f Makefile.bak ${PROG} a.out core errs lint.out tags *.o version.h
	rm -f machine.h.old new_machine.h
	(cd lib; ${MAKE} -f Makefile.skel clean)

install-strip: all FRC
	if [ -n "${SYMROOT}" ]; then \
	  mkdir -p ${SYMROOT}; \
	  cp -p ${PROG} ${SYMROOT}/${PROG}; \
	  if [ -x "${DS}" ]; then \
	    ${DS} -o ${SYMROOT}/${PROG}.dSYM ${SYMROOT}/${PROG}; \
	  fi \
	fi
	mkdir -p ${BIN}
	install -c -s -m 755 -g ${GRP} ${PROG} ${BIN}
	mkdir -p ${DOC}
	install -c -m 444 ${MAN} ${DOC}

install: all FRC
	@@echo ''
	@@echo 'Please write your own install rule.  Lsof for Darwin below 8'
	@@echo 'should be installed setgid to the group that has permission'
	@@echo 'to read /dev/kmem, often kmem or sys.  Lsof for Darwin 8 and'
	@@echo 'above should be installed setuid-root.  Your install rule'
	@@echo 'actions for Darwin below 8 might look something like this:'
	@@echo ''
	@@echo '    install -m 2xxx -g $${GRP} $${PROG} $${BIN}'
	@@echo '    install -m 444 $${MAN} $${DOC}'
	@@echo ''
	@@echo 'Your install rule actions for Darwin 8 and above might look'
	@@echo 'something like this:'
	@@echo ''
	@@echo '    install -m 4xxx -o root $${PROG} $${BIN}'
	@@echo '    install -m 444 $${MAN} $${DOC}'
	@@echo ''
	@@echo 'You will have to complete the xxx modes, the GRP value, and'
	@@echo 'the skeletons for the BIN and DOC strings, given at the'
	@@echo 'beginning of this Makefile, e.g.,'
	@@echo ''
	@@echo '    BIN= $${DESTDIR}/usr/local/etc'
	@@echo '    DOC= $${DESTDIR}/usr/man/man8'
	@@echo '    GRP= kmem'
	@@echo ''

${LIB}: FRC
	(cd lib; ${MAKE} DEBUG="${DEBUG}" CFGF="${CFGF}")

version.h:	FRC
	@@echo Constructing version.h
	@@rm -f version.h
	@@echo '#define	LSOF_BLDCMT	"${LSOF_BLDCMT}"' > version.h;
	@@echo '#define	LSOF_CC		"${CC}"' >> version.h
	@@echo '#define	LSOF_CCV	"${CCV}"' >> version.h
	@@echo '#define	LSOF_CCDATE	"'`date`'"' >> version.h
	@@echo '#define	LSOF_CCFLAGS	"'`echo ${CFLAGS} | sed 's/\\\\(/\\(/g' | sed 's/\\\\)/\\)/g' | sed 's/"/\\\\"/g'`'"' >> version.h
	@@echo '#define  LSOF_CINFO      "${CINFO}"' >> version.h
	@@if [ "X${LSOF_HOST}" = "X" ]; then \
	  echo '#define	LSOF_HOST	"'`uname -n`'"' >> version.h; \
	else \
	  if [ "${LSOF_HOST}" = "none" ]; then \
	    echo '#define	LSOF_HOST	""' >> version.h; \
	  else \
	    echo '#define	LSOF_HOST	"${LSOF_HOST}"' >> version.h; \
	  fi \
	fi
	@@echo '#define	LSOF_LDFLAGS	"${CFGL}"' >> version.h
	@@if [ "X${LSOF_LOGNAME}" = "X" ]; then \
	  echo '#define	LSOF_LOGNAME	"${LOGNAME}"' >> version.h; \
	else \
	  if [ "${LSOF_LOGNAME}" = "none" ]; then \
	    echo '#define	LSOF_LOGNAME	""' >> version.h; \
	  else \
	    echo '#define	LSOF_LOGNAME	"${LSOF_LOGNAME}"' >> version.h; \
	  fi; \
	fi
	@@if [ "X${LSOF_SYSINFO}" = "X" ]; then \
	    echo '#define	LSOF_SYSINFO	"'`uname -a`'"' >> version.h; \
	else \
	  if [ "${LSOF_SYSINFO}" = "none" ]; then \
	    echo '#define	LSOF_SYSINFO	""' >> version.h; \
	  else \
	    echo '#define	LSOF_SYSINFO	"${LSOF_SYSINFO}"' >> version.h; \
	  fi \
	fi
	@@if [ "X${LSOF_USER}" = "X" ]; then \
	  echo '#define	LSOF_USER	"${USER}"' >> version.h; \
	else \
	  if [ "${LSOF_USER}" = "none" ]; then \
	    echo '#define	LSOF_USER	""' >> version.h; \
	  else \
	    echo '#define	LSOF_USER	"${LSOF_USER}"' >> version.h; \
	  fi \
	fi
	@@sed '/VN/s/.ds VN \(.*\)/#define	LSOF_VERSION	"\1"/' < version >> version.h

FRC:

# DO NOT DELETE THIS LINE - make depend DEPENDS ON IT

ddev.o:		${HDR} ddev.c

dfile.o:	${HDR} dfile.c

dmnt.o:		${HDR} dmnt.c

dproc.o:	${HDR} dproc.c

dsock.o:	${HDR} dsock.c

dstore.o:	${HDR} dstore.c

arg.o:		${HDR} arg.c

main.o:		${HDR} main.c

misc.o:		${HDR} misc.c

node.o:		${HDR} node.c

print.o:	${HDR} print.c

proc.o:		${HDR} proc.c

store.o:	${HDR} store.c

usage.o:	${HDR} version.h usage.c

util.o:		${HDR} util.c

# *** Do not add anything here - It will go away. ***
@


1.7
log
@Revision 4.82
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.6 2008/10/21 16:15:16 abe Exp abe $
d12 2
d53 1
a53 1
	@@if [ -n "${SYMROOT}" ]; then \
d56 3
@


1.6
log
@Revision 4.81
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.5 2008/04/15 13:28:56 abe Exp abe $
d22 1
a22 1
GRP=    admin
@


1.5
log
@Revision 4.79
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.4 2006/03/27 23:23:13 abe Exp abe $
d22 1
a22 1
GRP=    kmem
d51 4
d56 1
a56 1
	install -c -s -m 2755 -g ${GRP} ${PROG} ${BIN}
@


1.4
log
@Revision 4.77
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.3 2005/11/01 20:18:44 abe Exp abe $
d27 1
a27 1
	arg.c main.c misc.c node.c print.c proc.c store.c usage.c
d30 1
a30 1
	arg.o main.o misc.o node.o print.o proc.o store.o usage.o
d165 2
@


1.3
log
@Put CINFO in version.h.
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.2 2005/11/01 19:45:15 abe Exp abe $
d26 1
a26 1
SRC=    dfile.c dmnt.c dproc.c dsock.c dstore.c \
d29 1
a29 1
OBJ=	dfile.o dmnt.o dproc.o dsock.o dstore.o \
d137 2
@


1.2
log
@Add Darwin libproc-based type information.
@
text
@d4 1
a4 1
# $Id: Makefile,v 1.1 2005/11/01 19:41:02 abe Exp abe $
d93 1
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# Darwin Makefile
d4 1
a4 1
# $Id: Makefile,v 1.2 2005/10/13 03:06:17 ajn Exp $
@
