head	1.8;
access;
symbols;
locks; strict;
comment	@ * @;


1.8
date	2012.04.10.16.41.04;	author abe;	state Exp;
branches;
next	1.7;

1.7
date	2011.08.07.22.52.30;	author abe;	state Exp;
branches;
next	1.6;

1.6
date	2009.03.25.19.21.37;	author abe;	state Exp;
branches;
next	1.5;

1.5
date	2008.10.21.16.15.16;	author abe;	state Exp;
branches;
next	1.4;

1.4
date	2006.03.27.23.23.13;	author abe;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.04.18.52.18;	author abe;	state Exp;
branches;
next	1.2;

1.2
date	2005.11.01.20.10.09;	author abe;	state Exp;
branches;
next	1.1;

1.1
date	2005.11.01.19.41.02;	author abe;	state Exp;
branches;
next	;


desc
@As received from Allan Nathanson, Apple Computer, Inc.
@


1.8
log
@Revision 4.86
@
text
@/*
 * dlsof.h -- Darwin header file for libproc-based lsof
 */


/*
 * Portions Copyright 2005-2007 Apple Inc.  All rights reserved.
 *
 * Copyright 2005 Purdue Research Foundation, West Lafayette, Indiana
 * 47907.  All rights reserved.
 *
 * Written by Allan Nathanson, Apple Inc., and Victor A. Abell, Purdue
 * University.
 *
 * This software is not subject to any license of the American Telephone
 * and Telegraph Company or the Regents of the University of California.
 *
 * Permission is granted to anyone to use this software for any purpose on
 * any computer system, and to alter it and redistribute it freely, subject
 * to the following restrictions:
 *
 * 1. Neither the authors, nor Apple Inc. nor Purdue University are
 *    responsible for any consequences of the use of this software.
 *
 * 2. The origin of this software must not be misrepresented, either
 *    by explicit claim or by omission.  Credit to the authors, Apple
 *    Inc. and Purdue University must appear in documentation and sources.
 *
 * 3. Altered versions must be plainly marked as such, and must not be
 *    misrepresented as being the original software.
 *
 * 4. This notice may not be removed or altered.
 */


/*
 * $Id: dlsof.h,v 1.7 2011/08/07 22:52:30 abe Exp $
 */


#if	!defined(DARWIN_LSOF_H)
#define	DARWIN_LSOF_H	1

#include <stdlib.h>
#include <dirent.h>
#include <setjmp.h>
#include <signal.h>
#include <string.h>
#include <unistd.h>
#include <wctype.h>
#include <arpa/inet.h>
#include <sys/attr.h>
#include <sys/fcntl.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <netinet/tcp_fsm.h>
#include <netinet/tcp_timer.h>
#include <rpc/rpc.h>
#include <rpc/pmap_prot.h>
#include <libproc.h>

# if DARWINV<900
#define	vst_blksize	st_blksize
#define	vst_dev		st_dev
#define	vst_ino		st_ino
#define	vst_mode	st_mode
#define	vst_nlink	st_nlink
#define	vst_rdev	st_rdev
#define	vst_size	st_size
# endif	/* DARWINV<=900 */

#define	COMP_P		const void
#define	DEVINCR		1024		/* device table malloc() increment */
#define	DIRTYPE		dirent		/* directory entry type */
typedef	uintptr_t	KA_T;
#define	KA_T_FMT_X	"0x%08lx"
#define	LOGINML		MAXLOGNAME
#define	MALLOC_P	void
#define	FREE_P		MALLOC_P
#define	MALLOC_S	size_t
#define	MAXSYSCMDL	(MAXCOMLEN - 1)	/* max system command name length */
#define	MOUNTED		MNT_MNTTAB 
#define	QSORT_P		void
#define	READLEN_T	int
#define	STRNCPY_L	size_t
#define	SZOFFTYPE	unsigned long long
					/* size and offset internal storage
					 * type */
#define	SZOFFPSPEC	"ll"		/* SZOFFTYPE printf specification
					 * modifier */


/*
 * Global storage definitions (including their structure definitions)
 */

struct file *Cfp;

struct mounts {
        char *dir;              	/* directory (mounted on) */
	char *fsname;           	/* file system
					 * (symbolic links unresolved) */
	char *fsnmres;           	/* file system
					 * (symbolic links resolved) */
        dev_t dev;              	/* directory st_dev */
	dev_t rdev;			/* directory st_rdev */
	INODETYPE inode;		/* directory st_ino */
	mode_t mode;			/* directory st_mode */
	mode_t fs_mode;			/* file system st_mode */
	int is_nfs;			/* 1 if NFS file system, 0 if not */
        struct mounts *next;    	/* forward link */
};

struct sfile {
	char *aname;			/* argument file name */
	char *name;			/* file name (after readlink()) */
	char *devnm;			/* device name (optional) */
	dev_t dev;			/* device */
	dev_t rdev;			/* raw device */
	u_short mode;			/* S_IFMT mode bits from stat() */
	int type;			/* file type: 0 = file system
				 	 *	      1 = regular file */
	INODETYPE i;			/* inode number */
	int f;				/* file found flag */
	struct sfile *next;		/* forward link */

};

#define	XDR_VOID	(const xdrproc_t)xdr_void 
#define	XDR_PMAPLIST	(const xdrproc_t)xdr_pmaplist

#  if	!defined(offsetof)
#define	offsetof(type, member)	((size_t)(&((type *)0)->member))
#  endif	/* !defined(offsetof) */

#endif	/* DARWIN_LSOF_H */
@


1.7
log
@Revision 4.85, part 1
@
text
@d37 1
a37 1
 * $Id: dlsof.h,v 1.6 2009/03/25 19:21:37 abe Exp $
d52 1
@


1.6
log
@Revision 4.82
@
text
@d37 1
a37 1
 * $Id: dlsof.h,v 1.5 2008/10/21 16:15:16 abe Exp abe $
d80 1
a80 1
#define	MAXSYSCMDL	MAXCOMLEN	/* max system command name length */
d109 1
@


1.5
log
@Revision 4.81
@
text
@d37 1
a37 1
 * $Id: dlsof.h,v 1.4 2006/03/27 23:23:13 abe Exp abe $
d74 2
a75 2
typedef	uint64_t	KA_T;
#define	KA_T_FMT_X	"%#llx"
@


1.4
log
@Revision 4.77
@
text
@d7 1
a7 1
 * Portions Copyright 2005 Apple Computer, Inc.  All rights reserved.
d12 2
a13 2
 * Written by Allan Nathanson, Apple Computer, Inc., and Victor A.
 * Abell, Purdue University.
d22 2
a23 2
 * 1. Neither the authors, nor Apple Computer, Inc. nor Purdue University
 *    are responsible for any consequences of the use of this software.
d27 1
a27 2
 *    Computer, Inc. and Purdue University must appear in documentation
 *    and sources.
d37 1
a37 1
 * $Id: dlsof.h,v 1.3 2005/11/04 18:52:18 abe Exp abe $
d47 1
d61 10
@


1.3
log
@First VAA revision
@
text
@d38 1
a38 1
 * $Id: dlsof.h,v 1.2 2005/11/01 20:10:09 abe Exp abe $
d62 2
a63 1
#define	DIRTYPE		dirent	/* directory entry type */
d70 1
@


1.2
log
@Add libproc-based indentification.
Update copyright information.
@
text
@d2 1
a2 1
 * dlsof.h - Darwin header file for libproc-based lsof
d38 1
a38 1
 * $Id: dlsof.h,v 1.1 2005/11/01 19:41:02 abe Exp abe $
a57 1
//#include <rpc/types.h>
a58 1

a60 8
//# if	defined(DTYPE_PSXSEM)
//#define	HASPSXSEM				/* has the POSIX semaphore file type */
//# endif	/* defined(DTYPE_PSXSEM) */

//# if	defined(DTYPE_PSXSHM)
//#define	HASPSXSHM				/* has the POSIX shared memory file type */
//# endif	/* defined(DTYPE_PSXSHM) */

a62 1

d64 1
a64 2
#define	KA_T_FMT_X	"0x%01lx"

a69 1

a72 1

d84 1
a84 1
struct file * Cfp;
a85 16
struct l_vfs {
//	KA_T addr;			/* kernel address */
	fsid_t	fsid;			/* file system ID */

# if	defined(MOUNT_NONE)
	short type;			/* type of file system */
# else	/* !defined(MOUNT_NONE) */
	char *typnm;			/* file system type name */
# endif	/* defined(MOUNT_NONE) */

	char *dir;			/* mounted directory */
	char *fsname;			/* file system name */
	struct l_vfs *next;		/* forward link */
};
extern struct l_vfs *Lvfs;

@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
 * dlsof.h - Darwin header file for lsof
d5 1
d7 1
a7 1
 * Copyright (c) 2005 Apple Computer, Inc. All rights reserved.
d9 1
a9 22
 * @@APPLE_LICENSE_HEADER_START@@
 * 
 * This file contains Original Code and/or Modifications of Original Code
 * as defined in and that are subject to the Apple Public Source License
 * Version 2.0 (the 'License'). You may not use this file except in
 * compliance with the License. Please obtain a copy of the License at
 * http://www.opensource.apple.com/apsl/ and read it before using this
 * file.
 * 
 * The Original Code and all software distributed under the License are
 * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
 * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
 * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 * Please see the License for the specific language governing rights and
 * limitations under the License.
 * 
 * @@APPLE_LICENSE_HEADER_END@@
 */

/*
 * Copyright 1994 Purdue Research Foundation, West Lafayette, Indiana
d12 2
a13 1
 * Written by Victor A. Abell
d22 2
a23 2
 * 1. Neither the authors nor Purdue University are responsible for any
 *    consequences of the use of this software.
d25 4
a28 3
 * 2. The origin of this software must not be misrepresented, either by
 *    explicit claim or by omission.  Credit to the authors and Purdue
 *    University must appear in documentation and sources.
d38 1
a38 1
 * $Id: dlsof.h,v 1.3 2005/10/20 02:03:45 ajn Exp $
@
