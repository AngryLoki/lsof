head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2004.01.08.02.18.41;	author abe;	state Exp;
branches;
next	;


desc
@Use bzip2 to compress the tar archive.
@


1.1
log
@Initial revision
@
text
@#!/bin/ksh
#
# GenericDistrib_bz2 -- generic lsof 4.x distribution file builder that
#			produces a bzip2'd archive
#
# Usage: GenericDistrib <dialect> [<suffix>]
#
#	<dialect>	dialect's subdirectory name
#
#	[<suffix>]	optional suffix for version number

cd $HOME/src/lsof4

# Get version number.

V=`sed '/VN/s/.ds VN \(.*\)/\1/' version`
if test $? -ne 0
then
  echo $V
  exit 1
fi

# Handle arguments.

if test $# -lt 1 -o $# -gt 2
then
  echo "Usage: <dialect> [<suffix>]"
  exit 1
fi
DIALECT=$1
if test $# -eq 2
then
  V=${V}$2
fi

# Set variable names.

DIR=lsof_${V}.${DIALECT}
TAR=${DIR}.tar
TARBZ2=${TAR}.bz2

# Prepare for premature exit.

trap 'rm -rf $DIR $TAR $TARBZ2; exit' 1 2 3 15

# Make a temporary directory with the relevant files in it and
# create a bzip2'd tar archive of it.

rm -rf $TAR $TARBZ2
$HOME/src/lsof4/support/GenericSubdir $1 $2
echo "Making $TAR ...\c"
tar cf $TAR $DIR
echo " done"
ls -l $TAR
echo "Removing $DIR ...\c"
rm -rf $DIR
echo " done"
echo "Bzip2'ing $TAR ...\c"
gzip -c $TAR > support/$TARBZ2
echo " done"
ls -l support/$TARBZ2
rm -f $TAR
@
