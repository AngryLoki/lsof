head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2015.07.07.20.22.07;	author abe;	state Exp;
branches;
next	1.2;

1.2
date	2002.04.19.11.53.37;	author abe;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.11.16.13.12;	author abe;	state Exp;
branches;
next	;


desc
@Add a new test identity to TestDB.
@


1.3
log
@Revision 4.89
@
text
@#!/bin/sh
#
# Add2TestDB -- add the current test to the lsof test suite DB
#
# This script saves the current TestDB file in TestDB.old and adds
# the words in config.cflags to it.  "-D" prefixes on the words are
# removed, the words are sorted, and they are joint in a single
# line that is catenated to TestDB if it isn't already there.
#
# $Id: Add2TestDB,v 1.2 2002/04/19 11:53:37 abe Exp abe $

# Check for config.flags.

if test ! -r config.cflags
then
  echo "$0: no ./config.cflags file"
  exit 1
fi

# Check for a current data base file.

if test ! -r TestDB
then
  echo "$0: no ./TestDB file"
  exit 1
fi

# Form a new data base line.

new=""
for i in `LC_ALL=C sort < config.cflags`
do
  w=`echo $i | sed 's/^-D//'`
  if test "X$new" = "X"
  then
    new=$w
  else
    new="$new $w"
  fi
done

# See if the new line is already in the data base.

grep "$new" TestDB > /dev/null 2>&1
if test $? -eq 0
then
  echo "\"$new\" is already in TestDB."
  exit 1
fi

# Build a new data base file.

if test ! -w TestDB
then
  echo "$0: can't write the following to the end of TestDB:"
  echo  "    \"$new\""
  exit 1
fi
rm -f TestDB.new
cp TestDB TestDB.new
chmod 644 TestDB.new
echo "$new" >> TestDB.new

# Archive the current data base file, if possible.

if test -d OLD
then
  dt=`date`
  dtm="========== $dt =========="
  if test -r OLD/TestDB
  then
    echo "$dtm" >> OLD/TestDB
  else
    echo "$dtm" > OLD/TestDB
  fi
  cat TestDB >> OLD/TestDB
fi

# Put the new data base file in place.

mv TestDB.new TestDB
echo "\"$new\" added to TestDB."
exit 0
@


1.2
log
@Miscellaneous updates.
@
text
@d10 1
a10 1
# $Id: Add2TestDB,v 1.1 2002/04/11 16:13:12 abe Exp abe $
d31 1
a31 1
for i in `sort < config.cflags`
@


1.1
log
@Initial revision
@
text
@d10 1
a10 1
# $Id$
d33 1
a33 1
  w=`echo $i | sed 's/^-D//`
d53 6
d61 1
d64 1
a64 1
# Archive the current data base file.
d66 1
a66 3
dt=`date`
dtm="========== $dt =========="
if test -r TestDB.old
d68 9
a76 3
  echo "$dtm" >> $TestDB.old
else
  echo "$dtm" > TestDB.old
a77 1
cat TestDB >> TestDB.old
@
